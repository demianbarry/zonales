<!--
/**
 * @version	$Id$
 * @package	Zonales
 * @copyright	Copyright (C) 2009 Mediabit. All rights reserved.
 * @license	GNU/GPL, see LICENSE.php
 *
 * Zonales is free software. This version may have been modified pursuant
 * to the GNU General Public License, and as distributed it includes or
 * is derivative of works licensed under the GNU General Public License or
 * other free or open source software licenses.
 * See COPYRIGHT.php for copyright notices and details.
 */
 -->
<dataConfig>
	<dataSource driver="com.mysql.jdbc.Driver" url="jdbc:mysql://<host>:<port>/<db>?zeroDateTimeBehavior=convertToNull" user="user" password="password"/>
    	<document name="article">
            	<entity name="item" pk="a.id" 

			query="select a.id, a.title, a.introtext, a.`fulltext`, a.metakey, a.metadesc, 
				s.title as section, cat.title as category, a.sectionid, a.catid,
				s.published as s_published, cat.published as cat_published,

				a.access as a_access, s.access as s_access, cat.access as cat_access,
				a.created, a.modified, a.publish_up, a.publish_down, a.state as a_state, a.hits,
				
				if(a.publish_up, true, false) as has_publish_up,
				if(a.publish_down, true, false) as has_publish_down

				from jos_content_dos a 
				inner join jos_users u on u.id = a.created_by
				left join jos_sections s on s.id = a.sectionid
				left join jos_categories cat on cat.id = a.catid"

                	deltaQuery="select a.id from jos_content_dos a where a.modified > '${dataimporter.last_index_time}'
				or a.created > '${dataimporter.last_index_time}'" >
				
            		<field column="id" name="id" />
            		<field column="title" name="title" />
            		<field column="introtext" name="intro_content" />
			<field column="fulltext" name="full_content" />
			<field column="metakey" name="metakey" />
			<field column="metadesc" name="metadesc" />

			<field column="section" name="section" />
			<field column="category" name="category" />
			<field column="catid" name="category_id" />
			<field column="sectionid" name="section_id" />
			<field column="s_published" name="section_published" />
			<field column="cat_published" name="category_published" />

			<field column="a_access" name="a_access" />
			<field column="s_access" name="section_access" />
			<field column="cat_access" name="category_access" />

			<field column="created" name="creationDate" />
			<field column="modified" name="modifiedDate" />
			<field column="has_publish_up" name="hasPublishUpDate" />
			<field column="has_publish_down" name="hasPublishDownDate" />
			<field column="publish_up" name="publishUpDate" />
			<field column="publish_down" name="publishDownDate" />
			<field column="hits" name="hits" />			

			<field column="a_state" name="published" />			

			<entity name="tags" 
                		query="select jcp.content_id, jcpf.name AS f_name
					from jos_custom_properties jcp
					inner join jos_content a on a.id = jcp.content_id
					inner join jos_custom_properties_fields jcpf on jcp.field_id = jcpf.id
					where content_id = '${item.id}'
					group by content_id, jcp.field_id
					order by content_id">
                		<field column="f_name" name="tags_names" />
                        </entity>
			<entity name="tags" 
                		query="select jcp.content_id, jcpv.name AS v_name
					from jos_custom_properties jcp
					inner join jos_content a on a.id = jcp.content_id
					inner join jos_custom_properties_values jcpv on jcp.value_id = jcpv.id
					where content_id = '${item.id}'
					order by content_id">
                		<field column="v_name" name="tags_values" />
                        </entity>
        	</entity>
    	</document>
</dataConfig>
