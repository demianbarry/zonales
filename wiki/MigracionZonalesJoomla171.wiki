#summary Proceso de migración a Joomla 1.7.1
#labels Featured

= Introducción =

Con el objetivo de estabilizar la instalación de Joomla en producción se comienza el proceso de migración a Joomla 1.7.1

= Proceso =

El proceso se desarrolla ordenadamente partiendo de una instalación fresca de Joomla 1.7.1 y agregando las extensiones, librerías y demás componentes necesarios.

== Instalación ==

Previo a la instalación de Joomla 1.7.1 se realizó una copia de la instancia de *test* de Zonales. 
A continuación se utilizó la extensión [http://redcomponent.com/jupgrade jUpgrade] para llevar los componentes _core_ de esta nueva copia a la nueva versión pero sobre todo para tener una versión actualizada de los datos de la base de datos.
Finalmente, se descargó el paquete full de Joomla 1.7.1, se limpió la carpeta de la instancia nueva, se descomprimió Joomla 1.7.1 en dicha carpeta y se realizó el proceso estándar de instalación.


Instalacion de template Z20, componente com_zonales, com_eqzonales.

== Variables mainframe y option ==
Se utilizan en varias extensiones de desarrollo propio para obtener datos de contexto.

Reemplazo de la variable mainframe por JFactory::getApplication(), antes era global ahora hay que setearla. 
$mainframe = JFactory::getApplication();

Reemplazo masivo por línea de comandos:

'$mainframe=JFactory::getApplication(); global ' -lHIRZ /var/www/html/zonales-nuevo/ | xargs -0 -l sed -i 's/$mainframe=JFactory::getApplication(); global /\$mainframe=JFactory::getApplication();/g'

Correcion de variable option, antes era global ahora hay que setearla, $option = JRequest::getCMD('option');


== Instalacion de mod_menuzonales. ==

== Instalación de com_zonales ==

Vista en la red, archivo default.php en version de moootools existente no tiene sentido la funcion setHTML, se reemplaza por set('html',html):

grep 'setHTML(' -lHIRZ /var/www/html/zonales-nuevo/components/com_zonales/views/enlared/tmpl/default.php | xargs -0 -l sed -i 's/setHTML(/set("html"/g'

  * Se deben unificar imagenes.

  * Se deben parametrizar datos de conexión a Solr.

Cambios del archivo de configuración config.xml. La estructura nueva es:

<?xml version="1.0" encoding="utf-8"?>
<config>
    <fields>
        <fieldset name="basic" label="Zonales config" description="Configuración de componente Zonales">
            <field name="menu_tag_prefix" type="text" default="menu_" label="MENUTAGPREFIX" description="TIP_MENUTAGPREFIX" />
            <field name="zonal_tag_prefix" type="text" default="zonal_" label="ZONALTAGPREFIX" description="TIP_ZONALTAGPREFIX" />
            <field name="@spacer" type="spacer" default="" label="" description="" />
            <field name="width_mapa_flash" type="text" default="800" label="Alto" description="tip_alto_mapa"/>
            <field name="height_mapa_flash" type="text" default="600" label="Ancho" description="tip_ancho_mapa"/>
            <field name="flash_file" type="text" default="mapa.swf" label="FLASHFILE" description="TIP_FLASHFILE"/>
            <field name="@spacer" type="spacer" default="" label="" description="" />
            <field name="recaptcha_publickey" type="text" default="6Lc8fwcAAAAAAP8aw0ojn_bac-OpAiPv3NnAg9lN" label="RECAPTCHA_PUBLICKEY" description="TIP_RECAPTCHA_PUBLICKEY"/>
            <field name="recaptcha_privatekey" type="text" default="6Lc8fwcAAAAAAMT7Q1z7Zy2xGWX5W6BVtBKB3foJ" label="RECAPTCHA_PRIVATEKEY" description="TIP_RECAPTCHA_PRIVATEKEY"/>
            <field name="root_value" type="sql" default="" query="SELECT id, label FROM #__custom_properties_values WHERE parent_id = 0" key_field="id" value_field="label" description="root_value_tip" />
        </fieldset>
    </fields>
</config>

= PENDIENTES =

== Login ==
  * Chequear funcionamiento estándar: registro de usuario, activación y login.
  * Agregar y/o modificar estilos de módulo de login para template z20.
  * Chequear funcionamiento de com_aapu.
  * En función de lo anterior, agregar seteo de zona del usuario.
  * Agregar plugin para seteo de la zona del usuario on login.

== Content ==
  * Chequear funcionamiento estándar de carga de noticias en front.
    * Instalar plugin editor CKEditor o similar.
    * Crear usuario autor.
    * Cargar noticia con imágenes y estilos complejos.
    * Publicar noticia.
  * Indexado
    * Capturar evento onContentAfterSave mediante plugin para indexar en Solr en formato JZone con campo fuente seteado en "Zonales".
  * Metadata
    * Incorporar mediante plugin seteo de localidad a la noticia.
    * Incorporar mediante plugin seteo de GeoPoint.
    * Incorporar mediante plugin seteo de tags.
  * Recuperación
    * Analizar funcionalidad del helper que pueda ser útil.

== Com Zonales ==
  * Agregar vista similar a Nuevos y Relevantes, pero con fuente "Zonales".
  * Incorporar filtro por zona.
  * Incoporar ecualizador?
  * Incorporar fuente al ecualizador?

== Custom Properties ==
Se debe reemplazar o directamente suprimir. No existe versión nativa para Joomla 1.7.
  * Evaluar vinculación de tags con contenido en mysql.
  * Generar front view para administración de tags de mongo.
  * Generar front view para administración de zonas mongo.

== Com Eq Zonales (Ecualizador)? ==
  * Vinculación con bandas y ecualizador del usuario ?.
  * Probar consulta con ecualizador.